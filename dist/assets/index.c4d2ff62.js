import{b as C,r as S,j as e,a as o,F as w,L as U,u as z,e as Z,R as H,f as W,h as G}from"./vendor.dfb973c3.js";import{C as v,S as F,T as x,L as A,B as l,I as j,g as B,h as X,i as Q,j as V,k as Y,l as q,H as O,m as K,n as $,U as ee,o as f,A as re,p as k,F as L,q as p,r as N,s as te,t as ne,u as se,v as oe}from"./@chakra-ui/react.a2c7fdc7.js";import{c as ie}from"./@supabase/supabase-js.80dd8b1a.js";import"./framer-motion.a1ef4d86.js";import"./@emotion/react.f82d7cad.js";import"./@emotion/styled.7c69c562.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var M,R=C.exports;M=R.createRoot,R.hydrateRoot;const ae="https://mffvjgbvtthawpkfqknk.supabase.co",ce="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mZnZqZ2J2dHRoYXdwa2Zxa25rIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NjQwNDgxNDEsImV4cCI6MTk3OTYyNDE0MX0.DaP5FawarSaGWrxPzIQ6qqEp7kObOOV8B8IxD_J8Z_Q",E=ie(ae,ce),J=s=>new Intl.DateTimeFormat("fr-FR",{dateStyle:"medium",timeStyle:"short"}).format(s),le=s=>new Intl.DateTimeFormat("fr-FR",{dateStyle:"short"}).format(s),y=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s);function de(){const[s,a]=S.exports.useState([]),[t,d]=S.exports.useState(null),[n,i]=S.exports.useState(null),c=5,g=async()=>{const{count:r,error:u}=await E.from("ads").select("*",{count:"exact",head:!0}).eq("active",!0);if(u){console.log("fetchNumAds error",u),i(u);return}d(r)},h=async()=>{const r=s.length,u=s,{data:I,error:b}=await E.from("ads").select("*").order("id",{ascending:!1}).range(r,r+c-1).eq("active",!0);if(b){console.log("fetchMoreAds error",b),i(b);return}let _=I;a([...u,..._])};return S.exports.useEffect(()=>{h(),g()},[]),console.log("ads",JSON.parse(JSON.stringify(s))),e(v,{padding:8,children:o(F,{columns:1,spacing:3,children:[n?e(v,{padding:1,children:e(x,{fontSize:"sm",children:JSON.stringify(n,null,4)})}):e(w,{}),e(v,{padding:1,children:o(x,{fontSize:"sm",children:[t," annonces"]})}),s.map(r=>e(A,{as:U,to:"/ads/"+r.id.toString(),isExternal:!0,variant:"custom",children:o(l,{p:"3",maxW:"360px",borderWidth:"1px",children:[e(j,{borderRadius:"md",src:r.raw.images_url[0],fallback:e(B,{})}),o(x,{mt:3,fontSize:"xl",fontWeight:"bold",color:"pink.800",children:[y(r.price)," \u2022 ",y(r.price_per_sqm),"/m\xB2"]}),e(x,{mt:0,fontSize:"xl",fontWeight:"bold",color:"pink.800",children:r.raw.rooms>1?r.raw.rooms+" pi\xE8ces de "+r.area+"m\xB2":r.raw.rooms+" pi\xE8ce de "+r.area+"m\xB2"}),e(x,{mt:1,fontSize:"md",fontWeight:"bold",color:"black",children:r.geojson.features[0].properties.label}),r.score>0?o(X,{mt:3,children:[e(Q,{color:"dimgrey",children:"Score"}),e(V,{children:r.score}),o(Y,{color:"dimgrey",children:[r.dvf.agg_mutations.length," mutations"]})]}):e(w,{}),e(x,{mt:3,mb:2,fontSize:"sm",lineHeight:"short",color:"dimgrey",children:J(Date.parse(r.inserted_at))})]})},r.unique_id)),e(q,{onClick:()=>h(),children:"+"})]})})}var m={};Object.defineProperty(m,"__esModule",{value:!0});m.applySettingDefaults=m.isBrowser=m.stripTrailingSlash=D=m.uuid=void 0;function ue(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){var a=Math.random()*16|0,t=s=="x"?a:a&3|8;return t.toString(16)})}var D=m.uuid=ue;function pe(s){return s.replace(/\/$/,"")}m.stripTrailingSlash=pe;const he=()=>typeof window<"u";m.isBrowser=he;function me(s,a){const{db:t,auth:d,realtime:n,global:i}=s,{db:c,auth:g,realtime:h,global:r}=a;return{db:Object.assign(Object.assign({},c),t),auth:Object.assign(Object.assign({},g),d),realtime:Object.assign(Object.assign({},h),n),global:Object.assign(Object.assign({},r),i)}}m.applySettingDefaults=me;function fe(){const s={features:[]},[a,t]=S.exports.useState(s),[d,n]=S.exports.useState(""),[i,c]=S.exports.useState(""),g=async h=>{if(h.length<5){t(s);return}fetch("https://api-adresse.data.gouv.fr/search/?q="+h.replace(/ /g,"+")+"&limit=1").then(r=>{if(!r.ok)throw Error(r.statusText);return r.body}).then(r=>{if(!r)return;const u=r.getReader();return new ReadableStream({start(I){function b(){u.read().then(({done:_,value:P})=>{if(_){I.close();return}I.enqueue(P),b()})}b()}})}).then(r=>new Response(r,{headers:{"Content-Type":"application/json"}}).json()).then(r=>{if(!r||r.features==null||r.features.length==0){t(s);return}let u=r;u.features[0].properties.type=="housenumber"&&u.features[0].properties.score>.8?(t(u),c(""),n("")):t(s)}).catch(r=>{c("Erreur de recherche d'adresse: "+r)})};return o(w,{children:[e(O,{color:"darkgrey",mt:5,children:"Modifier l'adresse"}),e(K,{onChange:h=>g(h.target.value)}),a.features.length>0?e("p",{children:a.features[0].properties.label}):e("p",{children:"\u200D"}),i&&e("div",{style:{color:"red"},children:i}),d&&e("div",{style:{color:"lightskyblue"},children:d})]})}async function ge(s){const{data:a,error:t}=await E.from("ads").select("*").eq("id",s.params.adId);if(t)throw console.log("adDetails loader",t),new Response(t.message,{status:404,statusText:"Not Found"});return a}function xe(){let a=z();if(a.length!=1)return o($,{children:["Error:",JSON.stringify(a,null,4)]});let t=a[0];console.log(t,typeof t);const d=t.raw.description.split(/\n|\. /);return e(v,{padding:8,children:o(F,{columns:1,spacing:3,children:[e(q,{onClick:()=>close(),children:"\u276E Retour"}),e(A,{href:t.raw.url,isExternal:!0,variant:"custom",children:e(O,{children:t.raw.title})}),e(O,{color:"darkgray",mt:5,children:"Description"}),d.map(n=>n.length<=2?e(w,{}):e(x,{children:n.charAt(0).toUpperCase()+n.slice(1)},D())),e("br",{}),t.raw.images_url.map(n=>e(j,{src:n,fallback:e(B,{})},D())),e(O,{color:"darkgray",mt:5,children:"Statistiques"}),o(ee,{children:[e(f,{children:e(A,{href:encodeURI("https://www.google.com/maps/search/?api=1&query="+t.geojson.features[0].properties.label),isExternal:!0,variant:"custom",children:t.geojson.features[0].properties.label})}),e(f,{children:y(t.price)}),t.raw.rooms>1?o(f,{children:[t.raw.rooms," pi\xE8ces de ",t.area,"m\xB2"]}):o(f,{children:[t.raw.rooms," pi\xE8ce de ",t.area,"m\xB2"]}),o(f,{children:[y(t.price_per_sqm),"/m\xB2"]}),o(f,{children:["Mise en ligne : ",J(Date.parse(t.inserted_at))]}),o(f,{children:["Statut : ",t.active?"active":"inactive"]}),o(f,{children:["Score : ",t.score]})]}),e(fe,{}),t.dvf.agg_mutations?o(w,{children:[e(O,{color:"darkgrey",mt:5,children:"Mutations DVF"}),o(re,{allowMultiple:!0,children:[e(k,{children:o(L,{children:[e(l,{p:"3",children:"Date"}),e(p,{}),e(l,{p:"3",children:"Distance"}),e(p,{}),e(l,{p:"3",children:"Prix"}),e(p,{}),e(l,{p:"3",children:"Lot"}),e(p,{}),e(l,{p:"3",children:"SRB"}),e(p,{}),e(l,{p:"3",children:e(N,{})})]})}),t.dvf.agg_mutations.map(n=>{let i=Date.parse(n.date_mutation),c="";return n.distances_m.forEach(g=>{c!=""&&(c+=" "),c+=g.toString()}),o(k,{children:[e(L,{children:o(te,{p:0,children:[e(l,{p:"3",children:le(i).slice(3)}),e(p,{}),o(l,{p:"3",children:[c.replace(" ","/"),"m"]}),e(p,{}),e(l,{p:"3",children:y(n.valeur_fonciere)}),e(p,{}),e(l,{p:"3",children:y(n.price_per_square_lot)}),e(p,{}),e(l,{p:"3",children:y(n.price_per_square_srb)}),e(p,{}),e(l,{p:"3",children:e(N,{})})]})}),e(ne,{pb:4,fontSize:10,children:e("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(n,null,1)})})]},D())})]})]}):e(w,{})]})})}const ye=se({components:{Link:{variants:{custom:{":hover":{textDecoration:"none"},":visited":{textDecoration:"none"}}}}}}),Se=Z([{path:"/",element:e(de,{}),errorElement:e(T,{})},{path:"ads/:adId",loader:ge,element:e(xe,{}),errorElement:e(T,{})}]);function T(){let s=G();return console.error(s),e("div",{children:"Dang!"})}M(document.getElementById("root")).render(e(H.StrictMode,{children:e(oe,{theme:ye,children:e(W,{router:Se})})}));
